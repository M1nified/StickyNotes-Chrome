"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),SyncMethod=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"synchronize",value:function(t){var e=this,n=new Promise(function(n,i){t?(e.offline=t,n()):IndexedDB.getNotes().then(function(t){e.offline=t,n()})});return n}},{key:"cmp",value:function(){var t={};this.updated=[],this.removed=[];var e=function(t){var e={},n=!0,i=!1,o=void 0;try{for(var a,r=t[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value;e[s.id]=s}}catch(l){i=!0,o=l}finally{try{!n&&r["return"]&&r["return"]()}finally{if(i)throw o}}return e}(this.offline),n=!0,i=!1,o=void 0;try{for(var a,r=this.online[Symbol.iterator]();!(n=(a=r.next()).done);n=!0){var s=a.value,l=s.id;s.last_update=parseInt(s.last_update);try{}catch(u){}(!e[l]||e[l].date<s.date)&&(t[l]=s,Note.isRemoved(s)?this.removed.push(l):this.updated.push(l))}}catch(d){i=!0,o=d}finally{try{!n&&r["return"]&&r["return"]()}finally{if(i)throw o}}var f=!0,h=!1,c=void 0;try{for(var v,y=this.offline[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var p=v.value,l=p.id;t[l]||(t[l]=p)}}catch(d){h=!0,c=d}finally{try{!f&&y["return"]&&y["return"]()}finally{if(h)throw c}}this["final"]=t}},{key:"notifyUpdates",value:function(){if(this["final"]&&Object.keys(this["final"]).length>0){var t=chrome.app.window.get("notes_launcher");if(t)try{t.contentWindow.updateNotes()}catch(e){console.log("Launcher has not been loaded yet.",e)}}this.updated&&this.updated.length>1?Notifications.notifyAboutUpdatedNotes(this.updated):this.updated&&1===this.updated.length&&Notifications.notifyAboutUpdatedNotes(this.updated[0]),this.removed&&this.removed.length>1?Notifications.notifyAboutRemovedNotes(this.updated):this.removed&&1===this.removed.length&&Notifications.notifyAboutRemovedNotes(this.updated[0])}}]),t}();