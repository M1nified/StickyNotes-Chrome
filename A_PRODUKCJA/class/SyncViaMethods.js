"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),_get=function e(t,n,o){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,n);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,o)}if("value"in r)return r.value;var c=r.get;if(void 0!==c)return c.call(o)},SyncViaProWebJect=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,null,[{key:"synchronize",value:function(e){var n=this,o=new Promise(function(o,r){_get(Object.getPrototypeOf(t),"synchronize",n).call(n,e).then(function(){n.getOnline().then(function(){n.cmp(),IndexedDB.putNotes(n["final"]),n.sendOnline(),n.notifyUpdates(),o()})})});return o}},{key:"getOnline",value:function(){var e=this,t=new Promise(function(t,n){$.ajax({url:"http://prowebject.com/stickynotes/web/panel/backend/getNotes.php",dataType:"json",method:"post",data:{pair_code:Sync.pwj_pair_code},error:function(e){console.error("prowebject.com error",e)}}).done(function(n){e.online=[];var o=!0,r=!1,i=void 0;try{for(var c,a=n[Symbol.iterator]();!(o=(c=a.next()).done);o=!0){var l=c.value,s=void 0;try{s=JSON.parse(l.note_object),e.online.push(s)}catch(u){s=null}}}catch(f){r=!0,i=f}finally{try{!o&&a["return"]&&a["return"]()}finally{if(r)throw i}}t()}).fail(function(e){console.error("prowebject.com error",e),t()})});return t}},{key:"sendOnline",value:function(){var e=this,t=new Promise(function(t,n){var o={notes:e["final"],pair_code:Sync.pwj_pair_code,clear:!0};$.ajax({url:"http://prowebject.com/stickynotes/web/panel/backend/putNotes.php",method:"post",dataType:"text",data:o,error:function(e){console.error("prowebject.com error",e)}}).done(function(e){t()}).fail(function(e){console.error("prowebject.com error",e),t()})});return t}}]),t}(SyncMethod),SyncViaGoogleDrive=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,Object.getPrototypeOf(t).apply(this,arguments))}return _inherits(t,e),_createClass(t,null,[{key:"synchronize",value:function(e){var n=this,o=new Promise(function(o,r){_get(Object.getPrototypeOf(t),"synchronize",n).call(n,e).then(function(){SyncFileSystem.requestFileSystem().then(SyncFileSystem.getFileEntries).then(SyncFileSystem.getNotesFromEntries).then(function(e){n.online=e||[],n.cmp(),IndexedDB.putNotes(n["final"]),SyncFileSystem.putNotes(n["final"]),n.notifyUpdates(),o()})})});return o}},{key:"listenForChanges",value:function(){this.listening||(this.listening=!0,chrome.syncFileSystem.onFileStatusChanged.addListener(function(e){this.onFileStatusChanged(e)}.bind(this)))}},{key:"onFileStatusChanged",value:function(e){/note_(\w|_)+/.test(e.fileEntry.name)&&"remote_to_local"===e.direction&&updateFileSingle(e.fileEntry)}}]),t}(SyncMethod);