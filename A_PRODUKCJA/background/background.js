"use strict";function _classCallCheck(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function n(n,e){for(var t=0;t<e.length;t++){var o=e[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(n,o.key,o)}}return function(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}}(),GLOBALS={pwj_sync:!1,pwj_pair_code:null,options:{}},StickyNotes=function n(){var e=this;_classCallCheck(this,n),chrome.app.runtime.onLaunched.addListener(function(){this.background=new App}.bind(this)),BackgroundListeners.run(),Store.run(),Sync.synchronizeNow(),Sync.syncLoop(),chrome.storage.sync.get("autorun",function(n){n&&n.autorun===!0?$(function(){console.log("AUTORUN ENABLED"),e.background=new App}):console.log("AUTORUN DISABELED")})},App=function(){function n(){_classCallCheck(this,n),console.log("LAUNCH"),this.initLaunching(),n.storageCheck()}return _createClass(n,[{key:"initLaunching",value:function(){Sync.updateTheWay(),this.continueLaunching()}},{key:"continueLaunching",value:function(){var n=this;IndexedDB.getNotes().then(function(e){console.log(e),n.notes=e,n.properLaunching(),Sync.synchronizeNow(e)})}},{key:"properLaunching",value:function(){chrome.storage.sync.get("allLaunch",function(e){e&&e.allLaunch?Notes.launchNotesNewIfEmpty(this.notes):n.openLauncher.call(this)}.bind(this))}}],[{key:"openLauncher",value:function(){chrome.app.window.create("/noteslauncher/noteslauncher.html",{id:"notes_launcher",innerBounds:{width:430,height:540},frame:{color:"#8C8C8C"}},function(n){this.notes&&(n.contentWindow.notes=this.notes)}.bind(this))}},{key:"storageCheck",value:function(){chrome.storage.sync.get(null,function(e){var t={};if(!e||!e.id_owner){var o=n.randOwnerId();t.id_owner=o}chrome.storage.sync.set(t)})}},{key:"randOwnerId",value:function(){var n=new Date,e=n.valueOf()+"_"+Math.random().toString().slice(2);return e}}]),n}(),BackgroundListeners={run:function(){console.log("LISTENERS"),chrome.runtime.onMessage.addListener(this.runtimeOnMessage),chrome.storage.onChanged.addListener(this.storageOnChanged),chrome.notifications.onClicked.addListener(Notifications.onClicked),this.customListener1=setInterval(function(){var n=chrome.app.window.getAll();0===n.length?Sync.syncLoopStop():Sync.syncLoopIsGoing||Sync.syncLoop()},3e3),this.storeListener1=setInterval(function(){Store.updatePurchasedElements()},1e4)},runtimeOnMessage:function(n,e,t){switch(n.func){case"openNewNote":Notes.openNewNote(n.presetcolor,n.presetfont);break;case"syncAll":Sync.synchronizeNow();break;case"syncAllDelayed":Sync.synchronize();break;case"toClipboard":toClipboard(n.val,t)}},storageOnChanged:function(n,e){n.pwj_sync||n.pwj_pair_code?Sync.updateTheWay():n.purchasedinapp&&Store.updatePurchasedElements()}},stickynotes=new StickyNotes;