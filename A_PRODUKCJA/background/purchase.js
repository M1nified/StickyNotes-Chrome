$(function(){getAllItems(),getPurchases(),$(".tabbutton").on("click",function(){$(".tabbutton").removeClass("tabcurrent"),$(".tabcontent").removeClass("tabcontenton");var t=$(this).addClass("tabcurrent").data("for");$(".tabcontent#"+t).addClass("tabcontenton")}),$(".showcountrysupport").on("click",function(){$("#countrysupport").fadeIn(300)})});var getAllItems=function(){google.payments.inapp.getSkuDetails({parameters:{env:"prod"},success:onSkuDetails,failure:onSkuDetailsFail})},onSkuDetails=function(t){console.log(t);var e=t.response.details.inAppProducts;displayShop(e)},onSkuDetailsFail=function(t){console.log(t)},displayShop=function(t){t.length>0&&($("#available").empty().removeClass("init").append('<ul class="itemlist"></ul>'),$("#countrysupport").hide());for(var e in t)if((void 0===url("#bgcolors")||/^color_background_.+/.test(t[e].sku)!==!1||"color_palette_background"===t[e].sku||/^color_box_background_.+/.test(t[e].sku)!==!1)&&void 0!==inAppProducts[t[e].sku]){var s=parseInt(t[e].prices[0].valueMicros),n=Math.floor(s/1e6),a=s%1e6/1e4;a=10>a?"0"+a:a,s=n+"."+a+" "+t[e].prices[0].currencyCode,$("#available>ul.itemlist").append("<li><table><tr><td><h2>"+inAppProducts[t[e].sku].title+"</h2><p>"+inAppProducts[t[e].sku].description+'</p></td><td class="price">'+s+'</td><td class="purchasebutton buy" data-sku="'+t[e].sku+'">&nbsp;</td></tr></table></li>')}},getPurchases=function(){google.payments.inapp.getPurchases({parameters:{env:"prod"},success:onLicenseUpdate,failure:onLicenseUpdateFail})},onLicenseUpdate=function(t){console.log(t);var e=t.response.details;displayPurchases(e)},onLicenseUpdateFail=function(t){console.log(t)},displayPurchases=function(t){t.length>0&&$("#purchased").empty().removeClass("init").append('<ul class="itemlist"></ul>');for(var e in t)"ACTIVE"===t[e].state&&void 0!==inAppProducts[t[e].sku]&&$("#purchased>ul.itemlist").append("<li><table><tr><td><h2>"+inAppProducts[t[e].sku].title+"</h2><p>"+inAppProducts[t[e].sku].description+'</p></td><td class="purchasebutton owned" data-sku="'+t[e].sku+'">&nbsp;</td></tr></table></li>')};$(document).on("click",".purchasebutton.buy",function(t){var e=$(this).data("sku");google.payments.inapp.buy({parameters:{env:"prod"},sku:e,success:onBuySuccess,failure:onBuyFailure})});var onBuySuccess=function(t){chrome.storage.sync.get("purchasedinapp",function(e){e&&void 0===e.purchasedinapp&&(e.purchasedinapp={}),items=e.purchasedinapp;var s=t.request.contents.line_item,n=chrome.runtime.id.toString();for(var a in s){var o=s[a],i=o.sku.split(n+"_inapp").join("");items[i]=!0}chrome.storage.sync.set({purchasedinapp:items})})},onBuyFailure=function(t){};